<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>My First2 Web Page</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1356.0.min.js"></script>
    <script src="/js/amazon-cognito-identity.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
</head>
<body>
    <div class="container fluid">
        <div class="container mt-5">
            <h1 class="text-center mb-4">VÃ¤lkommen!</h1>
            <h2 class="text-center mb-4">Login</h2>
            <form>
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" name="username" class="form-control">
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" name="password" class="form-control">
                </div>
                <input type="button" value="Logga in" onclick="signIN()" class="btn btn-primary">
            </form>
            </div>
           
            <hr>
            <div class="container mt-5">
            <h2 class="text-center my-4">Registrera</h2>
            <form>
                <div class="form-group">
                    <label for="username2">Username:</label>
                    <input type="text" id="username2" name="username" class="form-control">
                </div>
                <div class="form-group">
                    <label for="email2">Email:</label>
                    <input type="email" id="email2" name="email" class="form-control">
                </div>
                <div class="form-group">
                    <label for="password2">Password:</label>
                    <input type="password" id="password2" name="password" class="form-control">
                </div>
                <input type="button" value="Registrera" onclick="signUp()" class="btn btn-primary">
            </form>
        </div>
    </div>

      <h1>Keys from Lambda Function2</h1>
    <p>Key1: <span id="key1"></span></p>
    <p>Key2: <span id="key2"></span></p>
    <p>Key3: <span id="key3"></span></p>
    <button id="get-keys"> logga ut</button>
    <script src="/js/script.js"></script>
    <script>
    var poolData = {
        UserPoolId: 'eu-north-1_gFRRs0pAX',
        ClientId: '7r2bam11ounrq97okspbpjrtv0'
    };

    var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);

    function signIN() {
        var authenticationData = {
            Username: document.getElementById("username").value,
            Password: document.getElementById("password").value
        };

        var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);

        var userData = {
            Username: authenticationData.Username,
            Pool: userPool
        };

        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);

        cognitoUser.authenticateUser(authenticationDetails, {
            onSuccess: function(result) {
                console.log('access token + ' + result.getAccessToken().getJwtToken());
                console.log('id token + ' + result.getIdToken().getJwtToken());
                console.log('refresh token + ' + result.getRefreshToken().getToken());

                // Redirect to a different page or do something else after successful authentication
                
            },

            onFailure: function(err) {
                console.error(err);
                alert(err.message);
            },

            newPasswordRequired: function(userAttributes, requiredAttributes) {
                cognitoUser.completeNewPasswordChallenge('password123', {}, this);
            }
        });
    }

    function signOut() {
        var cognitoUser = userPool.getCurrentUser();

        if (cognitoUser) {
            cognitoUser.signOut();
            console.log('User signed out');
            window.location.href = 'https://thesis-secureinbrowser.s3.eu-north-1.amazonaws.com/pages/logout.html';
        }
    }

    function signUp() {
        var username = document.getElementById("username2").value;
        var email = document.getElementById("email2").value;
        var password = document.getElementById("password2").value;
    var attributeList = [];
    attributeList.push(new AmazonCognitoIdentity.CognitoUserAttribute({ Name: 'email', Value: email }));
    userPool.signUp(username, password, attributeList, null, function(err, result){
        if (err) {
            console.log(err);
            return;
        }
        var cognitoUser = result.user;
        console.log('username is ' + cognitoUser.getUsername());
        // Check if user needs to verify email
        if (result.userConfirmed === false) {
            // Redirect user to email verification page
            window.location.href = 'https://thesis-secureinbrowser.s3.eu-north-1.amazonaws.com/pages/verify-email.html?username=' + cognitoUser.getUsername();

        }
    });
}


   
            // ajax
            $(document).ready(function () {
                $("#get-keys").click(function () {
                    $.ajax({
                        url: "https://0gmpdmznid.execute-api.eu-north-1.amazonaws.com/default/THESIS-secureinbrowser/myFunction2",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify({
                            key1: "hello",
                            key2: "world",
                            key3: "testing"
                        }),
                        success: function (data) {
                            console.log(data);
                        },
                        error: function (xhr, status, error) {
                            console.log(xhr.responseText);
                        }
                    });
                });
            });
        
        // JavaScript code for fetching data
        fetch('https://0gmpdmznid.execute-api.eu-north-1.amazonaws.com/default/THESIS-secureinbrowser/myFunction2')
            .then(response => response.json())
            .then(data => {
            
                const key1 = data.key1;
                const key2 = data.key2;
                const key3 = data.key3;

                
                document.getElementById('key1').innerText = key1;
                document.getElementById('key2').innerText = key2;
                document.getElementById('key3').innerText = key3;
            })
            .catch(error => {
                console.error("Error: ", error);
            });
   


    </script>

<button onclick="signOut()">Sign Out</button>
</body>
</html>
